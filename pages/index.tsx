import { GetServerSideProps } from 'next';
import Head from 'next/head';
import Link from 'next/link';
import { MagnifyingGlassIcon, PlusIcon } from '@heroicons/react/24/outline';

import { Layout } from '@/components/Layout';
import { UserCard } from '@/components/UserCard';
import text from '@/public/locales/en/users.json';
import { fetcher } from '@/helpers/fetcher';
import { User } from '@/models/User';

const apiUrl = process.env.NEXT_PUBLIC_API_URL as string;

export const getServerSideProps: GetServerSideProps = async () => {
  const users: User[] = await fetcher(apiUrl);

  return {
    props: {
      users
    }
  };
};

export default function Home({ users }: { users: User[] }) {
  const role = (role: 'ADMIN' | 'DEV') => (role === 'ADMIN' ? text.administrator : text.regularUser);

  return (
    <>
      <Head>
        <title>Our users</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/logo_prediko.svg' />
      </Head>
      <main>
        <Layout>
          <div className='mt-10 mx-32'>
            <h2 className='font-bold text-title text-darkGrey drop-shadow-xs'>{text.title}</h2>
            <div className='my-8 h-14 flex flex-row justify-between'>
              <div className='p-5 w-80 flex flex-row items-center bg-white shadow-xs drop-shadow-xs rounded-2xl'>
                <div>
                  <MagnifyingGlassIcon className='w-6 text-darkGrey' />
                </div>
                {/* The text is black in the prototype but for better accessibility, I choose to use the dark grey color. Open to discussion. */}
                <span className='ml-4 text-darkGrey text-text font-medium'>{text.search}</span>
              </div>
              <Link href='user/new'>
                <button className='p-3 w-fit flex flex-row items-center bg-white shadow-xs drop-shadow-xs rounded-2xl'>
                  <div className='w-9 h-9 flex justify-center items-center rounded-xl bg-blue'>
                    <PlusIcon className='w-5 text-white' />
                  </div>
                  {/* The text is black in the prototype but for better accessibility, I choose to use the dark grey color. Open to discussion. */}
                  <span className='ml-4 text-darkGrey text-text font-medium'>{text.addUser}</span>
                </button>
              </Link>
            </div>
            <div className='my-11 w-full grid grid-cols-3 gap-x-7 gap-y-11'>
              {users.map((user) => (
                <UserCard username={`${user.first_name} ${user.last_name}`} role={user.role && role(user.role)} key={user.id} />
              ))}
            </div>
          </div>
        </Layout>
      </main>
    </>
  );
}
